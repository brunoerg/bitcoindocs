(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{444:function(e,t,a){"use strict";a.r(t);var n=a(43),i=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"_175"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_175"}},[e._v("#")]),e._v(" 175")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("  BIP: 175\n  Layer: Applications\n  Title: Pay to Contract Protocol\n  Author: Omar Shibli <omar@commerceblock.com>\n          Nicholas Gregory <nicholas@commerceblock.com>\n  Comments-Summary: No comments yet.\n  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0175\n  Status: Draft\n  Type: Informational\n  Created: 2017-07-17\n  License: BSD-2-Clause\n")])])]),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v('Utilizing hierarchical deterministic wallets as described in BIP-0032\nand the "Purpose Field" in BIP-0043, this document specifies the\nmultiparty pay-to-contract key derivation scheme outlined by Ilja\nGerhardt and Timo Hanke.[0]')]),e._v(" "),a("p",[e._v('The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL\nNOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and\n"OPTIONAL" in this document are to be interpreted as described in RFC\n2119.')]),e._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("p",[e._v('A Bitcoin transaction represents a "real world" contract between two\nparties transferring value. Counterparties in a business interaction\ntraditionally keep track of a payment with bills (invoices) and\nreceipts. Delivery of a good is made by the payee once the payer has\nsigned the receipt, agreeing to pay for the items on the invoice.\nGerhardt and Hanke [0] formulate this interaction within the confines\nof the Bitcoin protocol using homomorphic payment addresses and the\nmultiparty pay-to-contract protocol.')]),e._v(" "),a("p",[e._v("The protocol is constructed in such a way that all parties have\ncryptographic proof of both who is being paid and for what. Using the\ntechnique described in this BIP, an address can be provably derived from\nthe terms of a contract and the payee's public key. This derivation\nscheme does not bloat the UTXO and is completely hidden to network\nparticipants; the derived address looks like any other P2(W)PKH or\nP2(W)SH address. Redemption of the funds requires knowledge of the\ncontract and the payee's private key.")]),e._v(" "),a("p",[e._v("This scheme utilizes the foundations of BIP-0032, providing a consistent\nway for preexisting wallet developers to implement the specification.")]),e._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("p",[e._v('This key derivation scheme requires two parties: a payer (customer) and\na payee (merchant). The customer submits to the merchant a purchase\nrequest, specifying what goods/services they would like to buy. From the\npurchase request the merchant constructs an invoice (contract),\nspecifying the billable items and total amount to be paid. The merchant\nmust give this contract alongside a "payment base" extended public key\nto the customer. Given this information, the customer will be able to\nfulfill the contract by generating the public key of the payment address\nassociated with the contract and the payment base, then sending the\nfunds there.')]),e._v(" "),a("p",[e._v("We define the following levels in BIP32 path:")]),e._v(" "),a("p",[a("code",[e._v("m / purpose' / coin_type' / contract_hash")])]),e._v(" "),a("p",[a("code",[e._v("contract_hash")]),e._v(" consists of multiple levels.")]),e._v(" "),a("p",[e._v("Apostrophe in the path indicates that BIP32 hardened derivation is used.")]),e._v(" "),a("p",[e._v("We define the following extended public keys:")]),e._v(" "),a("p",[e._v("Payment base denoted as "),a("code",[e._v("payment_base")]),e._v(":")]),e._v(" "),a("p",[a("code",[e._v("m / purpose' / coin_type'")])]),e._v(" "),a("p",[e._v("Payment address denoted as "),a("code",[e._v("payment_address")]),e._v(":")]),e._v(" "),a("p",[a("code",[e._v("m / purpose' / coin_type' / contract_hash")]),a("br"),e._v(" "),a("code",[e._v("or")]),a("br"),e._v(" "),a("code",[e._v("m / payment_base / contract_hash")])]),e._v(" "),a("p",[e._v("Each level has special meaning described in the chapters below.")]),e._v(" "),a("h3",{attrs:{id:"purpose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#purpose"}},[e._v("#")]),e._v(" Purpose")]),e._v(" "),a("p",[e._v("Purpose is a constant set to "),a("code",[e._v("175'")]),e._v(" (or "),a("code",[e._v("0x800000AF")]),e._v(") following the\nBIP-0043 recommendation. It indicates that the subtree of this node is\nused according to this specification.")]),e._v(" "),a("p",[a("code",[e._v("m / 175' / *")])]),e._v(" "),a("p",[e._v("Hardened derivation is used at this level.")]),e._v(" "),a("h3",{attrs:{id:"coin-type-coin-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coin-type-coin-type"}},[e._v("#")]),e._v(" Coin type {#coin_type}")]),e._v(" "),a("p",[e._v("The coin type field is identical to the same field in BIP-0044.")]),e._v(" "),a("p",[e._v("Hardened derivation is used at this level.")]),e._v(" "),a("h3",{attrs:{id:"payment-address-generation-payment-address-generation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payment-address-generation-payment-address-generation"}},[e._v("#")]),e._v(" Payment address generation {#payment_address_generation}")]),e._v(" "),a("p",[e._v("For a given contract documents denoted by c~1~,...,c~n~, payment base\nextended public key denoted by "),a("code",[e._v("payment_base")]),e._v(", and cryptographic hash\nfunction denoted by "),a("code",[e._v("h")]),e._v(".")]),e._v(" "),a("p",[e._v("1. Compute cryptographic hashes for all contract documents, by applying\nthe hash function.")]),e._v(" "),a("p",[a("code",[e._v("h(c1),...,h(cn)")])]),e._v(" "),a("p",[e._v("2. Sort all hashes lexicographically.")]),e._v(" "),a("p",[a("code",[e._v("hash_1,...,hash_n")])]),e._v(" "),a("p",[e._v("3. Prepend payment_base and concatenate the sorted hashes and apply the\nhash function.")]),e._v(" "),a("p",[a("code",[e._v("h(payment_base+hash_1+...+hash_n)")])]),e._v(" "),a("p",[e._v("4. Compute a partial BIP32 derivation path from the combined hash as\ndefined in Hash to Partial Derivation Path Mapping procedure below.")]),e._v(" "),a("p",[a("code",[e._v("contract_hash")])]),e._v(" "),a("p",[e._v("5. Prepend "),a("code",[e._v("payment_base")]),e._v(" to contract_hash derivation path.")]),e._v(" "),a("p",[a("code",[e._v("payment_base / contract_hash")])]),e._v(" "),a("p",[e._v("6. Compute public extended key from the derivation path in step 5.")]),e._v(" "),a("p",[e._v("7. Compute address of the public extended key (P2PKH) from step 6.")]),e._v(" "),a("h3",{attrs:{id:"payment-address-verification-payment-address-verification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payment-address-verification-payment-address-verification"}},[e._v("#")]),e._v(" Payment address verification {#payment_address_verification}")]),e._v(" "),a("p",[e._v("For a given Bitcoin address, "),a("code",[e._v("payment_base")]),e._v(" extended public key,\ncontract documents denoted by c~1~,...,c~n~, and cryptographic hash\nfunction denoted by "),a("code",[e._v("h")]),e._v(", we can verify the integrity of the address by\nthe following steps:")]),e._v(" "),a("p",[e._v("1. Compute contract address from the given inputs as described in\nContract Address Generation section.")]),e._v(" "),a("p",[e._v("2. Compare the computed address from step 1 with the given Bitcoin\naddress as an input.")]),e._v(" "),a("h3",{attrs:{id:"redemption"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redemption"}},[e._v("#")]),e._v(" Redemption")]),e._v(" "),a("p",[e._v("The merchant is able to construct the private key offline using the\nmethod described in the Payment Address Generation section. The merchant\nshould actively monitor the blockchain for the payment to the payment\naddress. Because the address is generated from the payment base and the\ncontract, the merchant must implicitly agree to those terms in order to\nspend the funds. The act of making the payment to that address thus\nserves as a receipt for the customer.")]),e._v(" "),a("h3",{attrs:{id:"hash-to-partial-derivation-path-mapping-hash-to-partial-derivation-path-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash-to-partial-derivation-path-mapping-hash-to-partial-derivation-path-mapping"}},[e._v("#")]),e._v(" Hash to partial derivation path mapping {#hash_to_partial_derivation_path_mapping}")]),e._v(" "),a("p",[e._v("At this section, we define hash to partial BIP32 derivation path mapping\nprocedure that maps between an arbitrary hex number to a partial BIP32\nderivation path.")]),e._v(" "),a("p",[e._v("For a given hex number, do the following:")]),e._v(" "),a("p",[e._v("1. Partition hex number into parts, each part length is 4 chars.")]),e._v(" "),a("p",[e._v("2. Convert each part to integer in decimal format.")]),e._v(" "),a("p",[e._v("3. Concatenate all numbers with slash "),a("code",[e._v("/")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[e._v("#")]),e._v(" Examples")]),e._v(" "),a("p",[e._v("For the following given inputs:")]),e._v(" "),a("p",[a("code",[e._v("master private extended key:")]),a("br"),e._v(" "),a("code",[e._v("xprv9s21ZrQH143K2JF8RafpqtKiTbsbaxEeUaMnNHsm5o6wCW3z8ySyH4UxFVSfZ8n7ESu7fgir8imbZKLYVBxFPND1pniTZ81vKfd45EHKX73")]),a("br"),e._v(" "),a("code",[e._v("coin type:")]),a("br"),e._v(" "),a("code",[e._v("0")])]),e._v(" "),a("p",[e._v("we can compute payment base as follows:")]),e._v(" "),a("p",[a("code",[e._v("payment base derivation path:")]),a("br"),e._v(" "),a("code",[e._v("m/175'/0'")]),a("br"),e._v(" "),a("code",[e._v("contract base public extended key:")]),a("br"),e._v(" "),a("code",[e._v("xpub6B3JSEWjqm5GgfzcjPwBixxLPzi15pFM3jq4E4yCzXXUFS5MFdXiSdw7b5dbdPGHuc7c1V4zXbbFRtc9G1njMUt9ZvMdGVGYQSQsurD6HAW")])]),e._v(" "),a("p",[e._v("In the below examples, we are going to use SHA256 as a cryptographic\nhash function, and the above contract base public key.")]),e._v(" "),a("h4",{attrs:{id:"payment-address-generation-payment-address-generation-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payment-address-generation-payment-address-generation-1"}},[e._v("#")]),e._v(" Payment address generation {#payment_address_generation_1}")]),e._v(" "),a("p",[e._v("As an input, we have a contract that consists of two documents, below\nare contents:")]),e._v(" "),a("p",[e._v("document 1:")]),e._v(" "),a("p",[a("code",[e._v("bar")])]),e._v(" "),a("p",[e._v("document 2:")]),e._v(" "),a("p",[a("code",[e._v("foo")])]),e._v(" "),a("p",[e._v("1. Apply the hash function:")]),e._v(" "),a("p",[a("code",[e._v("document 1:")]),a("br"),e._v(" "),a("code",[e._v("fcde2b2edba56bf408601fb721fe9b5c338d10ee429ea04fae5511b68fbf8fb9")]),a("br"),e._v(" "),a("code",[e._v("document 2:")]),a("br"),e._v(" "),a("code",[e._v("2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae")])]),e._v(" "),a("p",[e._v("2. Sort all hashes lexicographically:")]),e._v(" "),a("p",[a("code",[e._v("2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae")]),a("br"),e._v(" "),a("code",[e._v("fcde2b2edba56bf408601fb721fe9b5c338d10ee429ea04fae5511b68fbf8fb9")])]),e._v(" "),a("p",[e._v("3. Concatenate hashes and apply the hash function.")]),e._v(" "),a("p",[a("code",[e._v("concatenated hash: payment_base")]),a("br"),e._v(" "),a("code",[e._v("xpub6B3JSEWjqm5GgfzcjPwBixxLPzi15pFM3jq4E4yCzXXUFS5MFdXiSdw7b5dbdPGHuc7c1V4zXbbFRtc9G1njMUt9ZvMdGVGYQSQsurD6HAW2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7aefcde2b2edba56bf408601fb721fe9b5c338d10ee429ea04fae5511b68fbf8fb9")]),a("br"),e._v(" "),a("code",[e._v("combined hash:")]),a("br"),e._v(" "),a("code",[e._v("310057788c6073640dc222466d003411cd5c1cc0bf2803fc6ebbfae03ceb4451")])]),e._v(" "),a("p",[e._v("4. Compute the partial BIP32 derivation path of the combined hash.")]),e._v(" "),a("p",[a("code",[e._v("12544/22392/35936/29540/3522/8774/27904/13329/52572/7360/48936/1020/28347/64224/15595/17489")])]),e._v(" "),a("p",[e._v("5. Prepend "),a("code",[e._v("payment_base")]),e._v(" to "),a("code",[e._v("contract_hash")]),e._v(" derivation path.")]),e._v(" "),a("p",[a("code",[e._v("contract_base_pub/12544/22392/35936/29540/3522/8774/27904/13329/52572/7360/48936/1020/28347/64224/15595/17489")]),a("br"),e._v(" "),a("code",[e._v("or")]),a("br"),e._v(" "),a("code",[e._v("m/175'/0'/12544/22392/35936/29540/3522/8774/27904/13329/52572/7360/48936/1020/28347/64224/15595/17489")])]),e._v(" "),a("p",[e._v("6. Compute public extended key.")]),e._v(" "),a("p",[a("code",[e._v("xpub6hefaATTG5LbcwyPDvmNfnkyzefoM2TJDoo5astH7Gvs1g8vZURviBWvAvBnWc2CNb8ybJ6mDpnQYVsvNSZ3oUmbssX3rUVG97TFYa6AXVk")])]),e._v(" "),a("p",[e._v("7. Compute address of the public extended key (P2PKH).")]),e._v(" "),a("p",[a("code",[e._v("1C7f322izqMqLzZzfzkPAjxBzprxDi47Yf")])]),e._v(" "),a("h4",{attrs:{id:"verification-example-negative-test-verification-example-negative-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#verification-example-negative-test-verification-example-negative-test"}},[e._v("#")]),e._v(" Verification example (negative test) {#verification_example_negative_test}")]),e._v(" "),a("p",[e._v("Similar to the input above, except this time we have a contract that\nconsists of one document, below is the content:")]),e._v(" "),a("p",[e._v("document 1:")]),e._v(" "),a("p",[a("code",[e._v("baz")])]),e._v(" "),a("p",[e._v("1. Apply the hash function.")]),e._v(" "),a("p",[a("code",[e._v("baa5a0964d3320fbc0c6a922140453c8513ea24ab8fd0577034804a967248096")])]),e._v(" "),a("p",[e._v("2. Prepend payment_base")]),e._v(" "),a("p",[a("code",[e._v("xpub6B3JSEWjqm5GgfzcjPwBixxLPzi15pFM3jq4E4yCzXXUFS5MFdXiSdw7b5dbdPGHuc7c1V4zXbbFRtc9G1njMUt9ZvMdGVGYQSQsurD6HAWbaa5a0964d3320fbc0c6a922140453c8513ea24ab8fd0577034804a967248096")])]),e._v(" "),a("p",[e._v("2. Apply hash function")]),e._v(" "),a("p",[a("code",[e._v("3a08605829413ce0bf551b08d21e4a28dbda6e407f90eff1c448e839050c73a1")])]),e._v(" "),a("p",[e._v("3. Compute the partial derivation path.")]),e._v(" "),a("p",[a("code",[e._v("5338/54412/19213/962/30664/62597/11873/59874/56779/24089/54550/19585/28087/36422/18666/17562")])]),e._v(" "),a("p",[e._v("4. Prepend contract_base~pub~ to contract_hash derivation path.")]),e._v(" "),a("p",[a("code",[e._v("contract_base_pub/5338/54412/19213/962/30664/62597/11873/59874/56779/24089/54550/19585/28087/36422/18666/17562")]),a("br"),e._v(" "),a("code",[e._v("or")]),a("br"),e._v(" "),a("code",[e._v("m/175'/0'/5338/54412/19213/962/30664/62597/11873/59874/56779/24089/54550/19585/28087/36422/18666/17562")])]),e._v(" "),a("p",[e._v("5. Compute public extended key.")]),e._v(" "),a("p",[a("code",[e._v("xpub6h9k2KqsMpwghxt7naj1puhGV1ZDC88sxvpYN1HibCf8yQZdPsuhYmmvdK32Kf2Lb3rS1sV8UcZ1f84DJEiXuVfLCAj4bC85aEUCxh38m8i")])]),e._v(" "),a("p",[e._v("7. Compute address of the public extended key (P2PKH).")]),e._v(" "),a("p",[a("code",[e._v("1QGe5LaDMAmHeibJbZBmZqhQDZSp7QCqSs")])]),e._v(" "),a("p",[e._v("8. As expected the address doesn't match the Bitcoin address from the\nlast example "),a("code",[e._v("1C7f322izqMqLzZzfzkPAjxBzprxDi47Yf")]),e._v(".")]),e._v(" "),a("p",[e._v("Verification operation will succeed only if we use identical documents\nto ones that have been used in the contract address generation.")]),e._v(" "),a("h2",{attrs:{id:"compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compatibility"}},[e._v("#")]),e._v(" Compatibility")]),e._v(" "),a("p",[e._v("This specification is not backward compatible with BIP32 specification,\nthe proposed derivation scheme in this BIP is a BIP32 compliant.\nCommunication between payer and payee as well as hashing the contract\nand generating the path requires significant modification to the wallet.")]),e._v(" "),a("h2",{attrs:{id:"reference-implementations-reference-implementations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference-implementations-reference-implementations"}},[e._v("#")]),e._v(" Reference implementations {#reference_implementations}")]),e._v(" "),a("ul",[a("li",[e._v("Reference wallet implementation, based on Copay project :\n"),a("a",{attrs:{href:"https://github.com/commerceblock/copay",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/commerceblock/copay"),a("OutboundLink")],1),e._v("\n("),a("a",{attrs:{href:"https://github.com/commerceblock/copay/pull/1",title:"wikilink",target:"_blank",rel:"noopener noreferrer"}},[e._v("pull_request"),a("OutboundLink")],1),e._v(")")]),e._v(" "),a("li",[e._v("Reference implementation to Hash to Partial Derivation Path Mapping\nin javascript\n("),a("a",{attrs:{href:"https://github.com/commerceblock/pay-to-contract-lib/blob/master/lib/contract.js",title:"wikilink",target:"_blank",rel:"noopener noreferrer"}},[a("a",{attrs:{href:"https://github.com/commerceblock/pay-to-contract-lib",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/commerceblock/pay-to-contract-lib"),a("OutboundLink")],1)]),e._v(")")])]),e._v(" "),a("h2",{attrs:{id:"reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"bip-0032.mediawiki",title:"wikilink"}},[e._v("BIP32 - Hierarchical Deterministic\nWallets")])]),e._v(" "),a("li",[a("a",{attrs:{href:"bip-0043.mediawiki",title:"wikilink"}},[e._v("BIP43 - Purpose Field for Deterministic\nWallets")])]),e._v(" "),a("li",[a("a",{attrs:{href:"bip-0044.mediawiki",title:"wikilink"}},[e._v("BIP44 - Multi-Account Hierarchy for Deterministic\nWallets")])]),e._v(" "),a("li",[a("a",{attrs:{href:"https://arxiv.org/abs/1212.3257",title:"wikilink",target:"_blank",rel:"noopener noreferrer"}},[e._v("Homomorphic Payment Addresses and the Pay-to-Contract\nProtocol"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("This BIP is licensed under the 2-clause BSD license.")])])}),[],!1,null,null,null);t.default=i.exports}}]);