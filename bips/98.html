<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>98 | Bitcoin Docs</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="apple-touch-icon" sizes="180x180" href="bitcoin.png">
    <link rel="icon" type="image/png" sizes="32x32" href="bitcoin.png">
    <link rel="icon" type="image/png" sizes="16x16" href="bitcoin.png">
    <link rel="mask-icon" href="bitcoin.png" color="#3a0839">
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" href="bitcoin.png">
    <meta name="description" content="">
    <meta name="theme-color" content="#ff7e00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/bitcoindocs/assets/css/0.styles.6b9516dd.css" as="style"><link rel="preload" href="/bitcoindocs/assets/js/app.c31d8641.js" as="script"><link rel="preload" href="/bitcoindocs/assets/js/2.b78a9106.js" as="script"><link rel="preload" href="/bitcoindocs/assets/js/123.64680142.js" as="script"><link rel="prefetch" href="/bitcoindocs/assets/js/10.68a64a6d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/100.bd554273.js"><link rel="prefetch" href="/bitcoindocs/assets/js/101.df38dcc3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/102.3bf2a9d4.js"><link rel="prefetch" href="/bitcoindocs/assets/js/103.d879654a.js"><link rel="prefetch" href="/bitcoindocs/assets/js/104.fcff9e3b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/105.324f3006.js"><link rel="prefetch" href="/bitcoindocs/assets/js/106.b8b3ca20.js"><link rel="prefetch" href="/bitcoindocs/assets/js/107.4a9863c3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/108.e93a5196.js"><link rel="prefetch" href="/bitcoindocs/assets/js/109.e770824e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/11.f67301bd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/110.72ba2ba4.js"><link rel="prefetch" href="/bitcoindocs/assets/js/111.a33eb12f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/112.ecf1c295.js"><link rel="prefetch" href="/bitcoindocs/assets/js/113.85f94e5b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/114.c79655f2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/115.3940b629.js"><link rel="prefetch" href="/bitcoindocs/assets/js/116.9ead4ccc.js"><link rel="prefetch" href="/bitcoindocs/assets/js/117.d4b75110.js"><link rel="prefetch" href="/bitcoindocs/assets/js/118.87575c0c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/119.65af5cbd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/12.fc1e786f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/120.99826b18.js"><link rel="prefetch" href="/bitcoindocs/assets/js/121.608c453c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/122.b24765eb.js"><link rel="prefetch" href="/bitcoindocs/assets/js/124.4b4f9bc2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/125.0e07a49d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/126.be3bae0f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/127.3d041c50.js"><link rel="prefetch" href="/bitcoindocs/assets/js/128.5feda1e3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/129.307399ad.js"><link rel="prefetch" href="/bitcoindocs/assets/js/13.47ba1b02.js"><link rel="prefetch" href="/bitcoindocs/assets/js/130.0659f005.js"><link rel="prefetch" href="/bitcoindocs/assets/js/131.69a612f3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/132.b51e17e2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/133.7bb492d9.js"><link rel="prefetch" href="/bitcoindocs/assets/js/134.0f7e8787.js"><link rel="prefetch" href="/bitcoindocs/assets/js/135.e2504a16.js"><link rel="prefetch" href="/bitcoindocs/assets/js/136.8b6c7216.js"><link rel="prefetch" href="/bitcoindocs/assets/js/137.e38fc5b2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/138.095843e4.js"><link rel="prefetch" href="/bitcoindocs/assets/js/139.4a5e77fb.js"><link rel="prefetch" href="/bitcoindocs/assets/js/14.42b93c7a.js"><link rel="prefetch" href="/bitcoindocs/assets/js/140.f517d934.js"><link rel="prefetch" href="/bitcoindocs/assets/js/141.7a6497c0.js"><link rel="prefetch" href="/bitcoindocs/assets/js/142.8ae1c029.js"><link rel="prefetch" href="/bitcoindocs/assets/js/143.2fadb8ac.js"><link rel="prefetch" href="/bitcoindocs/assets/js/144.a64d8f22.js"><link rel="prefetch" href="/bitcoindocs/assets/js/145.1b1fa851.js"><link rel="prefetch" href="/bitcoindocs/assets/js/146.a59efe37.js"><link rel="prefetch" href="/bitcoindocs/assets/js/147.a0a8fc92.js"><link rel="prefetch" href="/bitcoindocs/assets/js/148.e177254d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/149.88223d18.js"><link rel="prefetch" href="/bitcoindocs/assets/js/15.cdd298ba.js"><link rel="prefetch" href="/bitcoindocs/assets/js/150.c07e2220.js"><link rel="prefetch" href="/bitcoindocs/assets/js/151.843c50f7.js"><link rel="prefetch" href="/bitcoindocs/assets/js/152.4f34674a.js"><link rel="prefetch" href="/bitcoindocs/assets/js/153.c2ba1434.js"><link rel="prefetch" href="/bitcoindocs/assets/js/154.dec4842c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/155.ecd7b99f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/156.55d078d3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/157.44501232.js"><link rel="prefetch" href="/bitcoindocs/assets/js/158.79220932.js"><link rel="prefetch" href="/bitcoindocs/assets/js/159.33765ed3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/16.4c7eeecf.js"><link rel="prefetch" href="/bitcoindocs/assets/js/160.ea470a70.js"><link rel="prefetch" href="/bitcoindocs/assets/js/161.2dc38d81.js"><link rel="prefetch" href="/bitcoindocs/assets/js/162.a27303c6.js"><link rel="prefetch" href="/bitcoindocs/assets/js/163.31e293c1.js"><link rel="prefetch" href="/bitcoindocs/assets/js/164.fca747d6.js"><link rel="prefetch" href="/bitcoindocs/assets/js/165.52456cdd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/166.c2464f79.js"><link rel="prefetch" href="/bitcoindocs/assets/js/167.25467097.js"><link rel="prefetch" href="/bitcoindocs/assets/js/168.92664946.js"><link rel="prefetch" href="/bitcoindocs/assets/js/169.df73d115.js"><link rel="prefetch" href="/bitcoindocs/assets/js/17.b107683f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/170.08fb6e7e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/171.ba749017.js"><link rel="prefetch" href="/bitcoindocs/assets/js/172.c92581cb.js"><link rel="prefetch" href="/bitcoindocs/assets/js/173.1fce2c58.js"><link rel="prefetch" href="/bitcoindocs/assets/js/174.34c08943.js"><link rel="prefetch" href="/bitcoindocs/assets/js/175.0f3c7a0d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/176.36c2e712.js"><link rel="prefetch" href="/bitcoindocs/assets/js/177.15027195.js"><link rel="prefetch" href="/bitcoindocs/assets/js/178.a42c47f3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/179.e9af4276.js"><link rel="prefetch" href="/bitcoindocs/assets/js/18.608ae665.js"><link rel="prefetch" href="/bitcoindocs/assets/js/180.48a51584.js"><link rel="prefetch" href="/bitcoindocs/assets/js/181.cc255bc5.js"><link rel="prefetch" href="/bitcoindocs/assets/js/182.64362e5e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/183.256b3077.js"><link rel="prefetch" href="/bitcoindocs/assets/js/184.3139561e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/185.5af948dd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/19.8b76fc9c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/20.122a4ef0.js"><link rel="prefetch" href="/bitcoindocs/assets/js/21.1f8a8820.js"><link rel="prefetch" href="/bitcoindocs/assets/js/22.eb68688b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/23.9e751fd9.js"><link rel="prefetch" href="/bitcoindocs/assets/js/24.72ecb396.js"><link rel="prefetch" href="/bitcoindocs/assets/js/25.ad100f49.js"><link rel="prefetch" href="/bitcoindocs/assets/js/26.654fcf2f.js"><link rel="prefetch" href="/bitcoindocs/assets/js/27.fdb46ea9.js"><link rel="prefetch" href="/bitcoindocs/assets/js/28.b28d1103.js"><link rel="prefetch" href="/bitcoindocs/assets/js/29.979a7705.js"><link rel="prefetch" href="/bitcoindocs/assets/js/3.0ccb3eb1.js"><link rel="prefetch" href="/bitcoindocs/assets/js/30.27ab6b09.js"><link rel="prefetch" href="/bitcoindocs/assets/js/31.0b51055d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/32.e5d3f476.js"><link rel="prefetch" href="/bitcoindocs/assets/js/33.5325af50.js"><link rel="prefetch" href="/bitcoindocs/assets/js/34.6cc1e8e6.js"><link rel="prefetch" href="/bitcoindocs/assets/js/35.4f93edf4.js"><link rel="prefetch" href="/bitcoindocs/assets/js/36.56c4b763.js"><link rel="prefetch" href="/bitcoindocs/assets/js/37.d7fc3cc3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/38.ba47e0be.js"><link rel="prefetch" href="/bitcoindocs/assets/js/39.a4948230.js"><link rel="prefetch" href="/bitcoindocs/assets/js/4.f750dbd8.js"><link rel="prefetch" href="/bitcoindocs/assets/js/40.13f04ebc.js"><link rel="prefetch" href="/bitcoindocs/assets/js/41.efba2874.js"><link rel="prefetch" href="/bitcoindocs/assets/js/42.71cd6fcf.js"><link rel="prefetch" href="/bitcoindocs/assets/js/43.3dd10508.js"><link rel="prefetch" href="/bitcoindocs/assets/js/44.0e0f5018.js"><link rel="prefetch" href="/bitcoindocs/assets/js/45.4e467a20.js"><link rel="prefetch" href="/bitcoindocs/assets/js/46.fbc682be.js"><link rel="prefetch" href="/bitcoindocs/assets/js/47.79e3cde6.js"><link rel="prefetch" href="/bitcoindocs/assets/js/48.36d1a4f2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/49.5c861a4e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/5.8f3d1a69.js"><link rel="prefetch" href="/bitcoindocs/assets/js/50.0c7609ac.js"><link rel="prefetch" href="/bitcoindocs/assets/js/51.6497b8ba.js"><link rel="prefetch" href="/bitcoindocs/assets/js/52.6fef223e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/53.dc5dd169.js"><link rel="prefetch" href="/bitcoindocs/assets/js/54.560108ca.js"><link rel="prefetch" href="/bitcoindocs/assets/js/55.a09c65a8.js"><link rel="prefetch" href="/bitcoindocs/assets/js/56.f7f7c539.js"><link rel="prefetch" href="/bitcoindocs/assets/js/57.3b3dfb34.js"><link rel="prefetch" href="/bitcoindocs/assets/js/58.1048b51d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/59.01f56552.js"><link rel="prefetch" href="/bitcoindocs/assets/js/6.ea542132.js"><link rel="prefetch" href="/bitcoindocs/assets/js/60.1e424058.js"><link rel="prefetch" href="/bitcoindocs/assets/js/61.6d4493b3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/62.849c30d7.js"><link rel="prefetch" href="/bitcoindocs/assets/js/63.0c6aaa64.js"><link rel="prefetch" href="/bitcoindocs/assets/js/64.0d99b925.js"><link rel="prefetch" href="/bitcoindocs/assets/js/65.d60db57e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/66.c6c02735.js"><link rel="prefetch" href="/bitcoindocs/assets/js/67.c0c64c59.js"><link rel="prefetch" href="/bitcoindocs/assets/js/68.99f833eb.js"><link rel="prefetch" href="/bitcoindocs/assets/js/69.88769157.js"><link rel="prefetch" href="/bitcoindocs/assets/js/7.474d9a1c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/70.0a746051.js"><link rel="prefetch" href="/bitcoindocs/assets/js/71.9847fc9b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/72.8e04fa9b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/73.772916a2.js"><link rel="prefetch" href="/bitcoindocs/assets/js/74.9663297b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/75.66154da0.js"><link rel="prefetch" href="/bitcoindocs/assets/js/76.358626cf.js"><link rel="prefetch" href="/bitcoindocs/assets/js/77.8eafda69.js"><link rel="prefetch" href="/bitcoindocs/assets/js/78.782695f1.js"><link rel="prefetch" href="/bitcoindocs/assets/js/79.99523f6b.js"><link rel="prefetch" href="/bitcoindocs/assets/js/8.7a9d23a8.js"><link rel="prefetch" href="/bitcoindocs/assets/js/80.2c556ea8.js"><link rel="prefetch" href="/bitcoindocs/assets/js/81.b70d3d0d.js"><link rel="prefetch" href="/bitcoindocs/assets/js/82.f0c621cf.js"><link rel="prefetch" href="/bitcoindocs/assets/js/83.13117f68.js"><link rel="prefetch" href="/bitcoindocs/assets/js/84.2361b62a.js"><link rel="prefetch" href="/bitcoindocs/assets/js/85.e8f23ad0.js"><link rel="prefetch" href="/bitcoindocs/assets/js/86.eab303cd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/87.a547f760.js"><link rel="prefetch" href="/bitcoindocs/assets/js/88.3c748686.js"><link rel="prefetch" href="/bitcoindocs/assets/js/89.6b7de962.js"><link rel="prefetch" href="/bitcoindocs/assets/js/9.6e1ca0bd.js"><link rel="prefetch" href="/bitcoindocs/assets/js/90.0907331e.js"><link rel="prefetch" href="/bitcoindocs/assets/js/91.fe47eeeb.js"><link rel="prefetch" href="/bitcoindocs/assets/js/92.f4c67fe3.js"><link rel="prefetch" href="/bitcoindocs/assets/js/93.efdc2e47.js"><link rel="prefetch" href="/bitcoindocs/assets/js/94.b7862723.js"><link rel="prefetch" href="/bitcoindocs/assets/js/95.06e410a5.js"><link rel="prefetch" href="/bitcoindocs/assets/js/96.0cc67031.js"><link rel="prefetch" href="/bitcoindocs/assets/js/97.b9460d90.js"><link rel="prefetch" href="/bitcoindocs/assets/js/98.0689894c.js"><link rel="prefetch" href="/bitcoindocs/assets/js/99.f18fe9ac.js">
    <link rel="stylesheet" href="/bitcoindocs/assets/css/0.styles.6b9516dd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bitcoindocs/" class="home-link router-link-active"><!----> <span class="site-name">Bitcoin Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bitcoindocs/whitepaper/" class="nav-link">
  Whitepaper
</a></div><div class="nav-item"><a href="/bitcoindocs/releases/" class="nav-link">
  Releases
</a></div><div class="nav-item"><a href="/bitcoindocs/bips/" class="nav-link router-link-active">
  BIPs
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bitcoindocs/whitepaper/" class="nav-link">
  Whitepaper
</a></div><div class="nav-item"><a href="/bitcoindocs/releases/" class="nav-link">
  Releases
</a></div><div class="nav-item"><a href="/bitcoindocs/bips/" class="nav-link router-link-active">
  BIPs
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>BIPs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bitcoindocs/bips/" aria-current="page" class="sidebar-link">Bitcoin Improvement Proposals</a></li><li><a href="/bitcoindocs/bips/1.html" class="sidebar-link">1</a></li><li><a href="/bitcoindocs/bips/2.html" class="sidebar-link">2</a></li><li><a href="/bitcoindocs/bips/8.html" class="sidebar-link">8</a></li><li><a href="/bitcoindocs/bips/9.html" class="sidebar-link">9</a></li><li><a href="/bitcoindocs/bips/16.html" class="sidebar-link">16</a></li><li><a href="/bitcoindocs/bips/32.html" class="sidebar-link">32</a></li><li><a href="/bitcoindocs/bips/39.html" class="sidebar-link">39</a></li><li><a href="/bitcoindocs/bips/42.html" class="sidebar-link">42</a></li><li><a href="/bitcoindocs/bips/43.html" class="sidebar-link">43</a></li><li><a href="/bitcoindocs/bips/44.html" class="sidebar-link">44</a></li><li><a href="/bitcoindocs/bips/45.html" class="sidebar-link">45</a></li><li><a href="/bitcoindocs/bips/47.html" class="sidebar-link">47</a></li><li><a href="/bitcoindocs/bips/49.html" class="sidebar-link">49</a></li><li><a href="/bitcoindocs/bips/50.html" class="sidebar-link">50</a></li><li><a href="/bitcoindocs/bips/60.html" class="sidebar-link">60</a></li><li><a href="/bitcoindocs/bips/61.html" class="sidebar-link">61</a></li><li><a href="/bitcoindocs/bips/62.html" class="sidebar-link">62</a></li><li><a href="/bitcoindocs/bips/64.html" class="sidebar-link">64</a></li><li><a href="/bitcoindocs/bips/65.html" class="sidebar-link">65</a></li><li><a href="/bitcoindocs/bips/66.html" class="sidebar-link">66</a></li><li><a href="/bitcoindocs/bips/67.html" class="sidebar-link">67</a></li><li><a href="/bitcoindocs/bips/68.html" class="sidebar-link">68</a></li><li><a href="/bitcoindocs/bips/69.html" class="sidebar-link">69</a></li><li><a href="/bitcoindocs/bips/70.html" class="sidebar-link">70</a></li><li><a href="/bitcoindocs/bips/71.html" class="sidebar-link">71</a></li><li><a href="/bitcoindocs/bips/72.html" class="sidebar-link">72</a></li><li><a href="/bitcoindocs/bips/73.html" class="sidebar-link">73</a></li><li><a href="/bitcoindocs/bips/74.html" class="sidebar-link">74</a></li><li><a href="/bitcoindocs/bips/75.html" class="sidebar-link">75</a></li><li><a href="/bitcoindocs/bips/78.html" class="sidebar-link">78</a></li><li><a href="/bitcoindocs/bips/79.html" class="sidebar-link">79</a></li><li><a href="/bitcoindocs/bips/80.html" class="sidebar-link">80</a></li><li><a href="/bitcoindocs/bips/81.html" class="sidebar-link">81</a></li><li><a href="/bitcoindocs/bips/83.html" class="sidebar-link">83</a></li><li><a href="/bitcoindocs/bips/84.html" class="sidebar-link">84</a></li><li><a href="/bitcoindocs/bips/85.html" class="sidebar-link">85</a></li><li><a href="/bitcoindocs/bips/90.html" class="sidebar-link">90</a></li><li><a href="/bitcoindocs/bips/91.html" class="sidebar-link">91</a></li><li><a href="/bitcoindocs/bips/98.html" aria-current="page" class="active sidebar-link">98</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#abstract" class="sidebar-link">Abstract</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#copyright" class="sidebar-link">Copyright</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#motivation" class="sidebar-link">Motivation</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#specification" class="sidebar-link">Specification</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#inclusion-proofs-inclusion-proofs" class="sidebar-link">Inclusion Proofs {#inclusion_proofs}</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#fast-merkle-lists-fast-merkle-lists" class="sidebar-link">Fast Merkle Lists {#fastmerklelists}</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#deployment" class="sidebar-link">Deployment</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#compatibility" class="sidebar-link">Compatibility</a></li><li class="sidebar-sub-header"><a href="/bitcoindocs/bips/98.html#references" class="sidebar-link">References</a></li></ul></li><li><a href="/bitcoindocs/bips/99.html" class="sidebar-link">99</a></li><li><a href="/bitcoindocs/bips/100.html" class="sidebar-link">100</a></li><li><a href="/bitcoindocs/bips/101.html" class="sidebar-link">101</a></li><li><a href="/bitcoindocs/bips/102.html" class="sidebar-link">102</a></li><li><a href="/bitcoindocs/bips/103.html" class="sidebar-link">103</a></li><li><a href="/bitcoindocs/bips/104.html" class="sidebar-link">104</a></li><li><a href="/bitcoindocs/bips/105.html" class="sidebar-link">105</a></li><li><a href="/bitcoindocs/bips/106.html" class="sidebar-link">106</a></li><li><a href="/bitcoindocs/bips/107.html" class="sidebar-link">107</a></li><li><a href="/bitcoindocs/bips/109.html" class="sidebar-link">109</a></li><li><a href="/bitcoindocs/bips/111.html" class="sidebar-link">111</a></li><li><a href="/bitcoindocs/bips/112.html" class="sidebar-link">112</a></li><li><a href="/bitcoindocs/bips/113.html" class="sidebar-link">113</a></li><li><a href="/bitcoindocs/bips/114.html" class="sidebar-link">114</a></li><li><a href="/bitcoindocs/bips/115.html" class="sidebar-link">115</a></li><li><a href="/bitcoindocs/bips/116.html" class="sidebar-link">116</a></li><li><a href="/bitcoindocs/bips/117.html" class="sidebar-link">117</a></li><li><a href="/bitcoindocs/bips/118.html" class="sidebar-link">118</a></li><li><a href="/bitcoindocs/bips/119.html" class="sidebar-link">119</a></li><li><a href="/bitcoindocs/bips/120.html" class="sidebar-link">120</a></li><li><a href="/bitcoindocs/bips/121.html" class="sidebar-link">121</a></li><li><a href="/bitcoindocs/bips/122.html" class="sidebar-link">122</a></li><li><a href="/bitcoindocs/bips/123.html" class="sidebar-link">123</a></li><li><a href="/bitcoindocs/bips/124.html" class="sidebar-link">124</a></li><li><a href="/bitcoindocs/bips/125.html" class="sidebar-link">125</a></li><li><a href="/bitcoindocs/bips/126.html" class="sidebar-link">126</a></li><li><a href="/bitcoindocs/bips/127.html" class="sidebar-link">127</a></li><li><a href="/bitcoindocs/bips/130.html" class="sidebar-link">130</a></li><li><a href="/bitcoindocs/bips/131.html" class="sidebar-link">131</a></li><li><a href="/bitcoindocs/bips/132.html" class="sidebar-link">132</a></li><li><a href="/bitcoindocs/bips/133.html" class="sidebar-link">133</a></li><li><a href="/bitcoindocs/bips/134.html" class="sidebar-link">134</a></li><li><a href="/bitcoindocs/bips/135.html" class="sidebar-link">135</a></li><li><a href="/bitcoindocs/bips/136.html" class="sidebar-link">136</a></li><li><a href="/bitcoindocs/bips/137.html" class="sidebar-link">137</a></li><li><a href="/bitcoindocs/bips/140.html" class="sidebar-link">140</a></li><li><a href="/bitcoindocs/bips/141.html" class="sidebar-link">141</a></li><li><a href="/bitcoindocs/bips/142.html" class="sidebar-link">142</a></li><li><a href="/bitcoindocs/bips/143.html" class="sidebar-link">143</a></li><li><a href="/bitcoindocs/bips/144.html" class="sidebar-link">144</a></li><li><a href="/bitcoindocs/bips/145.html" class="sidebar-link">145</a></li><li><a href="/bitcoindocs/bips/146.html" class="sidebar-link">146</a></li><li><a href="/bitcoindocs/bips/147.html" class="sidebar-link">147</a></li><li><a href="/bitcoindocs/bips/148.html" class="sidebar-link">148</a></li><li><a href="/bitcoindocs/bips/149.html" class="sidebar-link">149</a></li><li><a href="/bitcoindocs/bips/150.html" class="sidebar-link">150</a></li><li><a href="/bitcoindocs/bips/151.html" class="sidebar-link">151</a></li><li><a href="/bitcoindocs/bips/152.html" class="sidebar-link">152</a></li><li><a href="/bitcoindocs/bips/154.html" class="sidebar-link">154</a></li><li><a href="/bitcoindocs/bips/155.html" class="sidebar-link">155</a></li><li><a href="/bitcoindocs/bips/156.html" class="sidebar-link">156</a></li><li><a href="/bitcoindocs/bips/157.html" class="sidebar-link">157</a></li><li><a href="/bitcoindocs/bips/158.html" class="sidebar-link">158</a></li><li><a href="/bitcoindocs/bips/159.html" class="sidebar-link">159</a></li><li><a href="/bitcoindocs/bips/171.html" class="sidebar-link">171</a></li><li><a href="/bitcoindocs/bips/173.html" class="sidebar-link">173</a></li><li><a href="/bitcoindocs/bips/174.html" class="sidebar-link">174</a></li><li><a href="/bitcoindocs/bips/175.html" class="sidebar-link">175</a></li><li><a href="/bitcoindocs/bips/176.html" class="sidebar-link">176</a></li><li><a href="/bitcoindocs/bips/178.html" class="sidebar-link">178</a></li><li><a href="/bitcoindocs/bips/179.html" class="sidebar-link">179</a></li><li><a href="/bitcoindocs/bips/180.html" class="sidebar-link">180</a></li><li><a href="/bitcoindocs/bips/197.html" class="sidebar-link">197</a></li><li><a href="/bitcoindocs/bips/199.html" class="sidebar-link">199</a></li><li><a href="/bitcoindocs/bips/300.html" class="sidebar-link">300</a></li><li><a href="/bitcoindocs/bips/301.html" class="sidebar-link">301</a></li><li><a href="/bitcoindocs/bips/310.html" class="sidebar-link">310</a></li><li><a href="/bitcoindocs/bips/320.html" class="sidebar-link">320</a></li><li><a href="/bitcoindocs/bips/322.html" class="sidebar-link">322</a></li><li><a href="/bitcoindocs/bips/325.html" class="sidebar-link">325</a></li><li><a href="/bitcoindocs/bips/339.html" class="sidebar-link">339</a></li><li><a href="/bitcoindocs/bips/340.html" class="sidebar-link">340</a></li><li><a href="/bitcoindocs/bips/341.html" class="sidebar-link">341</a></li><li><a href="/bitcoindocs/bips/342.html" class="sidebar-link">342</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_98"><a href="#_98" class="header-anchor">#</a> 98</h1> <div class="language- extra-class"><pre><code>  BIP: 98
  Layer: Consensus (soft fork)
  Title: Fast Merkle Trees
  Author: Mark Friedenbach &lt;mark@friedenbach.org&gt;
          Kalle Alm &lt;kalle.alm@gmail.com&gt;
          BtcDrak &lt;btcdrak@gmail.com&gt;
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0098
  Status: Draft
  Type: Standards Track
  Created: 2017-08-24
  License: CC-BY-SA-4.0
  License-Code: MIT
</code></pre></div><h2 id="abstract"><a href="#abstract" class="header-anchor">#</a> Abstract</h2> <p>In many applications it is useful to prove membership of a data element
in a set without having to reveal the entire contents of that set. The
Merkle hash-tree, where inner/non-leaf nodes are labeled with the hash
of the labels or values of its children, is a cryptographic tool that
achieves this goal. Bitcoin uses a Merkle hash-tree construct for
committing the transactions of a block into the block header. This
particular design, created by Satoshi, suffers from a serious flaw
related to duplicate entries documented in the National Vulnerability
Database as CVE-2012-2459[1], and also suffers from less than optimal
performance due to unnecessary double-hashing.</p> <p>This Bitcoin Improvement Proposal describes a more efficient Merkle
hash-tree construct that is not vulnerable to CVE-2012-2459 and achieves
an approximate 55% decrease in hash-tree construction and validation
times as compared with fully optimized implementations of the Satoshi
Merkle hash-tree construct.</p> <h2 id="copyright"><a href="#copyright" class="header-anchor">#</a> Copyright</h2> <p>This BIP is licensed under a Creative Commons Attribution-ShareAlike
license. All provided source code is licensed under the MIT license.</p> <h2 id="motivation"><a href="#motivation" class="header-anchor">#</a> Motivation</h2> <p>A Merkle hash-tree is a directed acyclic graph data structure where all
non-terminal nodes are labeled with the hash of combined labels or
values of the node(s) it is connected to. Bitcoin uses a unique Merkle
hash-tree construct invented by Satoshi for calculating the block header
commitment to the list of transactions in a block. While it would be
convenient for new applications to make use of this same data structure
so as to share implementation and maintenance costs, there are three
principle drawbacks to reuse.</p> <p>First, Satoshi's Merkle hash-tree has a serious vulnerability[1]
related to duplicate tree entries that can cause bugs in protocols that
use it. While it is possible to secure protocols and implementations
against exploit of this flaw, it requires foresight and it is a bit more
tricky to design secure protocols that work around this vulnerability.
Designers of new protocols ought avoid using the Satoshi Merkle
hash-tree construct where at all possible in order to responsibly
decrease the likelihood of downstream bugs in naïve implementations.</p> <p>Second, Satoshi's Merkle hash-tree performs an unnecessary number of
cryptographic hash function compression rounds, resulting in
construction and validation times that are approximately three (3) times
more computation than is strictly necessary in a naïve implementation,
or 2.32x more computation in an implementation specialized for this
purpose only[2]. New implementations that do not require backwards
compatibility ought to consider hash-tree implementations that do not
carry this unnecessary performance hit.</p> <p>Third, Satoshi's algorithm presumes construction of a tree index from
an ordered list, and therefore is designed to support balanced trees
with a uniform path length from root to leaf for all elements in the
tree. Many applications, on the other hand, benefit from having
unbalanced trees, particularly if the shorter path is more likely to be
used. While it is possible to make a few elements of a Satoshi hash-tree
have shorter paths than the others, the tricks for doing so are
dependent on the size of the tree and not very flexible.</p> <p>Together these three reasons provide justification for specifying a
standard Merkle hash-tree structure for use in new protocols that fixes
these issues. This BIP describes such a structure, and provides an
example implementation.</p> <h2 id="specification"><a href="#specification" class="header-anchor">#</a> Specification</h2> <p>A Merkle hash-tree as defined by this BIP is an arbitrarily-balanced
binary tree whose terminal/leaf nodes are labelled with the
double-SHA256 hashes of data, whose format is outside the scope of this
BIP, and inner nodes with labels constructed from the fast-SHA256 hash
of its children's labels. The following image depicts an example
unbalanced hash-tree:</p> <p>:</p> <div class="language- extra-class"><pre><code>:   ![](bip-0098/unbalanced-hash-tree.png &quot;fig:bip-0098/unbalanced-hash-tree.png&quot;)
</code></pre></div><p><strong>A</strong>, <strong>B</strong>, and <strong>C</strong> are leaf labels, 32-byte double-SHA256 hashes of
the data associated with the leaf. <strong>Node</strong> and <strong>Root</strong> are inner
nodes, whose labels are fast-SHA256 (defined below) hashes of their
respective children's labels. <strong>Node</strong> is labelled with the fast-SHA256
hash of the concatenation of <strong>B</strong> and <strong>C</strong>. <strong>Root</strong> is labelled with
the fast-SHA256 hash of the concatenation of <strong>A</strong> and <strong>Node</strong>, and is
the <em>Merkle root</em> of the tree. Nodes with single children are not
allowed.</p> <p>The <em>double-SHA256</em> cryptographic hash function takes an
arbitrary-length data as input and produces a 32-byte hash by running
the data through the SHA-256 hash function as specified in FIPS
180-4[3], and then running the same hash function again on the 32-byte
result, as a protection against length-extension attacks.</p> <p>The <em>fast-SHA256</em> cryptographic hash function takes two 32-byte hash
values, concatenates these to produce a 64-byte buffer, and applies a
single run of the SHA-256 hash function with a custom 'initialization
vector' (IV) and without message paddding. The result is a 32-byte
'midstate' which is the combined hash value and the label of the inner
node. The changed IV protects against path-length extension attacks
(grinding to interpret a hash as both an inner node and a leaf).
fast-SHA256 is only defined for two 32-byte inputs. The custom IV is the
intermediate hash value generated after performing a standard SHA-256 of
the following hex-encoded bytes and extracting the midstate:</p> <p><code>cbbb9d5dc1059ed8 e7730eaff25e24a3 f367f2fc266a0373 fe7a4d34486d08ae</code><br> <code>d41670a136851f32 663914b66b4b3c23 1b9e3d7740a60887 63c11d86d446cb1c</code></p> <p>This data is the first 512 fractional bits of the square root of 23, the
9th prime number. The resulting midstate is used as IV for the
fast-SHA256 cryptographic hash function:</p> <p><code>static unsigned char _MidstateIV[32] =</code><br> <code>{ 0x89, 0xcc, 0x59, 0xc6, 0xf7, 0xce, 0x43, 0xfc,</code><br> <code>0xf6, 0x12, 0x67, 0x0e, 0x78, 0xe9, 0x36, 0x2e,</code><br> <code>0x76, 0x8f, 0xd2, 0xc9, 0x18, 0xbd, 0x42, 0xed,</code><br> <code>0x0e, 0x0b, 0x9f, 0x79, 0xee, 0xf6, 0x8a, 0x24 };</code></p> <p>As fast-SHA256 is only defined for two (2) 32-byte hash inputs, there
are necessarily two special cases: an empty Merkle tree is not allowed,
nor is any root hash defined for such a &quot;tree&quot;; and a Merkle tree with
a single value has a root hash label equal to that self-same value of
the leaf branch, the only node in the tree (a passthrough operation with
no hashing).</p> <h3 id="rationale"><a href="#rationale" class="header-anchor">#</a> Rationale</h3> <p>The fast-SHA256 hash function can be calculated 2.32x faster than a
specialized double-SHA256 implementation[2], or three (3) times faster
than an implementation applying a generic SHA-256 primitive twice, as
hashing 64 bytes of data with SHA-256 as specified by FIPS 180-4[3]
takes two compression runs (because of message padding) and then a third
compression run for the double-SHA256 construction. Validating a
fast-SHA256 Merkle root is therefore more than twice as fast as the
double-SHA256 construction used by Satoshi in bitcoin. Furthermore the
fastest fast-SHA256 implementation <em>is</em> the generic SHA-256
implementation, enabling generic circuitry and code reuse without a cost
to performance.</p> <p>The application of fast-SHA256 to inner node label updates is safe in
this limited domain because the inputs are hash values and fixed in
number and in length, so the sorts of attacks prevented by message
padding and double-hashing do not apply.</p> <p>The 'initialization vector' for fast-SHA256 is changed in order to
prevent a category of attacks on higher level protocols where a partial
collision can serve as both a leaf hash and as an inner node commitment
to another leaf hash. The IV is computed using standard SHA-256 plus
midstate extraction so as to preserve compatibility with cryptographic
library interfaces that do not support custom IVs, at the cost of a 2x
performance hit if neither custom IVs nor resuming from midstate are
supported. The data hashed is a nothing-up-my-sleeve number that is
unlikely to have a known hash preimage. The prime 23 was chosen as the
leading fractional bits of the first eight (8) primes, two (2) through
nineteen (19), are constants used in the setup of SHA-256 itself. Using
the next prime in sequence reduces the likelihood of introducing
weakness due to reuse of a constant factor.</p> <p>The Merkle root hash of a single element tree is a simple pass-through
of the leaf hash without modification so as to allow for chained
validation of split proofs. This is particularly useful when the
validation environment constrains proof sizes, such as push limits in
Bitcoin script. Chained validation allows a verifier to split one proof
into two or more, where the leaf is shown to be under an inner node, and
that inner node is shown to be under the root. Without pass-through
hashing in a single-element tree, use of chained validation would
unnecessarily introduce a minimum path length requirement equal to the
number of chain links. Pass-through hashing of single elements allows
instead for one or more of the chained validations to use a &quot;NOP&quot;
proof consisting of a zero-length path, thereby allowing, for example, a
fixed series of four (4) chained validations to verify a length three
(3) or shorter path.</p> <h2 id="inclusion-proofs-inclusion-proofs"><a href="#inclusion-proofs-inclusion-proofs" class="header-anchor">#</a> Inclusion Proofs {#inclusion_proofs}</h2> <p>An important use of Merkle hash-trees is the ability to compactly prove
membership with log-sized proofs. This section specifies a standard
encoding for a multi-element inclusion proof.</p> <p>To prove that a set of hashes is contained within a Merkle tree with a
given root requires four pieces of information:</p> <ol><li>The root hash of the Merkle tree;</li> <li>The hash values to be verified, a set usually consisting of the
double-SHA256 hash of data elements, but potentially the labels of
inner nodes instead, or both;</li> <li>The paths from the root to the nodes containing the values under
consideration, expressed as a serialized binary tree structure; and</li> <li>The hash values of branches not taken along those paths.</li></ol> <p>Typically the last two elements, the paths and the elided branch hashes,
are lumped together and referred to as the <em>proof</em>.</p> <p>Serialization begins with a variable-length integer (VarInt) used to
encode N, the number of internal nodes in the proof. Next the structure
of the tree is traversed using depth-first, left-to-right, pre-order
algorithm to visit each internal nodes, which are serialized using a
packed 3-bit representation for the configuration of each node,
consuming <code>(3*N + 7) / 8</code> bytes. Then the number skipped hashes (those
included in the proof, not verified by the proof) is serialized as a
variable-length integer (VarInt), followed by the hashes themselves in
the order previously traversed.</p> <p>There are eight possible configurations of internal nodes, as given in
the following diagram:</p> <p>:</p> <div class="language- extra-class"><pre><code>:   ![](bip-0098/node-variants.png &quot;fig:bip-0098/node-variants.png&quot;)
</code></pre></div><p>In this diagram, DESCEND means the branch links to another internal
node, as indicated by its child graph elements labeled &quot;...&quot;; SKIP
means the branch contains a hash of an elided subtree or element, and
the fast-SHA256 root hash of this subtree or double-SHA256 hash of the
element is included in the proof structure; and VERIFY means the branch
contains an externally provided hash that is needed as witness for the
verification of the proof. In tabular form, these code values are:</p> <hr> <p>Code   Left      Right
000    VERIFY    SKIP
001    VERIFY    VERIFY
010    VERIFY    DESCEND
011    DESCEND   SKIP
100    DESCEND   VERIFY
101    DESCEND   DESCEND
110    SKIP      VERIFY
111    SKIP      DESCEND</p> <hr> <p>These 3-bit codes are packed into a byte array such that eight (8) codes
would fit in every three (3) bytes. The order of filling a byte begins
with the most significant bit <code>0x80</code> and ends with the least significant
bit <code>0x01</code>. Unless the number of inner nodes is a multiple of eight (8),
there will be excess low-order bits in the final byte of serialization.
These excess bits must be zero.</p> <p>Note that the tree serialization is self-segmenting. By tracking tree
structure a proof reader will know when the parser has reached the last
internal node. The number of inner nodes serialized in the proof MUST
equal the number of nodes inferred from the tree structure itself.
Similarly, the number of SKIP hashes can also be inferred from the tree
structure as serialized, and MUST equal the number of hashes provided
within the proof.</p> <p>The single-hash proof has N=0 (the number of inner nodes), the tree
structure is not serialized (as there are no inner nodes), and the
number of SKIP hashes can be either 0 or 1.</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <p>Consider the following Merkle tree structure:</p> <p>:</p> <div class="language- extra-class"><pre><code>:   ![](bip-0098/traversal-example.png &quot;fig:bip-0098/traversal-example.png&quot;)
</code></pre></div><p>There are six (6) internal nodes. The depth-first, left-to-right,
pre-order traversal of the tree visits these nodes in the following
order: A, B, D, F, C, then E. There are three (3) skipped hashes,
visited in the following order: 0x00..., 0x66..., and 0x22... The
remaining four (4) hashes are provided at runtime to be verified by the
proof.</p> <hr> <div class="language- extra-class"><pre><code>      Byte 1     Byte 2     Byte 3
</code></pre></div><p>Bits    76543210   76543210   76543210
Nodes   AAABBBDD   DFFFCCCE   EE------
Code    10111101   10000100   01000000</p> <hr> <p>The serialization begins with the VarInt encoded number of inner nodes,
<code>0x06</code>, followed by the tree serialization itself, <code>0xbd8440</code>. Next the
number of SKIP hashes is VarInt encoded, <code>0x03</code>, followed by the three
(3) hashes in sequence. The resulting 101 byte proof, encoded in
base64:.</p> <p><code>Br2EQAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGZmZmZmZmZmZmZmZmZmZmZmZmZm</code><br> <code>ZmZmZmZmZmZmZmZmREREREREREREREREREREREREREREREREREREREREREQ=</code></p> <h3 id="rationale-rationale-1"><a href="#rationale-rationale-1" class="header-anchor">#</a> Rationale {#rationale_1}</h3> <p>The 3-bit encoding for inner nodes allows encoding all relevant
configurations of the nodes where the left and right branches can each
be one of {DESCEND, SKIP, VERIFY}. The excluded 9th possibility would
have both branches as SKIP:</p> <p>:</p> <div class="language- extra-class"><pre><code>:   ![](bip-0098/skip-skip.png &quot;fig:bip-0098/skip-skip.png&quot;)
</code></pre></div><p>This possibility is not allowed as for verification purposes it is
entirely equivalent to the shorter proof where the branch to that node
was SKIP'ed. Disallowing a node with two SKIP branches eliminates what
would otherwise be a source of proof malleability.</p> <p>The number of hashing operations required to verify a proof is one less
than the number of hashes (SKIP and VERIFY combined), and is exactly
equal to the number of inner nodes serialized as the beginning of the
proof as N. The variable-length integer encoding has the property that
serialized integers, sorted lexigraphically, will also be sorted
numerically. Since the first serialized item is the number of inner
nodes, sorting proofs lexigraphically has the effect of sorting the
proofs by the amount of work required to verify.</p> <p>The number of hashes required as input for verification of a proof is
N+1 minus the number of SKIP hashes, and can be quickly calculated
without parsing the tree structure.</p> <p>The coding and packing rules for the serialized tree structure were also
chosen to make lexigraphical comparison useful (or at least not
meaningless). If we consider a fully-expanded tree (no SKIP hashes, all
VERIFY) to be encoding a list of elements in the order traversed
depth-first from left-to-right, then we can extract proofs for subsets
of the list by SKIP'ing the hashes of missing values and recursively
pruning any resulting SKIP,SKIP nodes. Lexigraphically comparing the
resulting serialized tree structures is the same as lexigraphically
comparing lists of indices from the original list verified by the
derived proof.</p> <p>Because the number of inner nodes and the number of SKIP hashes is
extractible from the tree structure, both variable-length integers in
the proof are redundant and could have been omitted. However that would
require either construction and storage of the explicit tree in memory
at deserialization time, or duplication of the relatively complicated
tree parsing code in both the serialization and verification methods.
For that reason (as well as to handle the single-hash edge case) the
redundant inner node and SKIP hash counts are made explicit in the
serialization, and the two values must match what is inferred from the
tree structure for a proof to be valid. This makes deserialization
trivial and defers tree construction until verification time, which has
the additional benefit of enabling log-space verification algorithms.</p> <h2 id="fast-merkle-lists-fast-merkle-lists"><a href="#fast-merkle-lists-fast-merkle-lists" class="header-anchor">#</a> Fast Merkle Lists {#fast_merkle_lists}</h2> <p>Many applications use a Merkle tree to provide indexing of, or compact
membership proofs about the elements in a list. This addendum specifies
an algorithm that constructs a canonical balanced tree structure for
lists of various lengths. It differs in a subtle but important way from
the algorithm used by Satoshi so as to structurally prevent the
vulnerability described in [1].</p> <ol><li>Begin with a list of arbitrary data strings.</li> <li>Pre-process the list by replacing each element with its
double-SHA256 hash.</li> <li>If the list is empty, return the zero hash.</li> <li>While the list has 2 or more elements,
<ul><li>Pass through the list combining adjacent entries with the
fast-SHA256 hash. If the list has an odd number of elements,
leave the last element as-is (this fixes [1]). This step
reduces a list of N elements to ceil(N/2) entries.</li></ul></li> <li>The last remaining item in the list is the Merkle root.</li></ol> <p>This algorithm differs from Merkle lists used in bitcoin in two ways.
First, fast-SHA256 is used instead of double-SHA256 for inner node
labels. Second, final entries on an odd-length list are not duplicated
and hashed, which is the mistake that led to CVE-2012-2459[1].</p> <h2 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h2> <p>An implementation of this BIP for extraction of Merkle branches and
fast, log-space Merkle branch validation is available at the following
Github repository:</p> <p><a href="https://github.com/maaku/bitcoin/tree/fast-merkle-tree" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Also included in this repo is a 'merklebranch' RPC for calculating
root values and extracting inclusion proofs for both arbitrary trees and
trees constructed from lists of values using the algorithm in this BIP,
and a 'mergemerklebranch' RPC for unifying two or more fast Merkle
tree inclusion proofs--replacing SKIP hashes in one proof with a
subtree extracted from another.</p> <h2 id="deployment"><a href="#deployment" class="header-anchor">#</a> Deployment</h2> <p>This BIP is used by BIP116 (MERKLEBRANCHVERIFY)[4] to add Merkle
inclusion proof verification to script by means of a soft-fork NOP
expansion opcode. Deployment of MERKLEBRANCHVERIFY would make the
contents of this BIP consensus critical. The deployment plan for BIP116
is covered in the text of that BIP.</p> <h2 id="compatibility"><a href="#compatibility" class="header-anchor">#</a> Compatibility</h2> <p>This BIP on its own does not cause any backwards incompatibility.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p>[1] <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-2459" target="_blank" rel="noopener noreferrer">National Vulnerability Database:
CVE-2012-2459<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>[2] <a href="https://github.com/sipa/bitcoin/tree/201709_dsha256_64" target="_blank" rel="noopener noreferrer">github.com:sipa/bitcoin
201709_dsha256_64<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Pieter Wuille, September 2017, personal communication. By making use of
knowledge that the inputs at each stage are fixed length, Mr. Wuille was
able to achieve a 22.7% reduction in the time it takes to compute the
double-SHA256 hash of 64 bytes of data, the hash aggregation function of
the Satoshi Merkle tree construction.</p> <p>[3] <a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf" target="_blank" rel="noopener noreferrer">Secure Hash
Standard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>[4] <a href="https://github.com/bitcoin/bips/blob/master/bip-0116.mediawiki" target="_blank" rel="noopener noreferrer">BIP 116
MERKLEBRANCHVERIFY<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bitcoindocs/bips/91.html" class="prev">
        91
      </a></span> <span class="next"><a href="/bitcoindocs/bips/99.html">
        99
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/bitcoindocs/assets/js/app.c31d8641.js" defer></script><script src="/bitcoindocs/assets/js/2.b78a9106.js" defer></script><script src="/bitcoindocs/assets/js/123.64680142.js" defer></script>
  </body>
</html>
